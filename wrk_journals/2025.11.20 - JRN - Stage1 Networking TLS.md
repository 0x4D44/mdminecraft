# 2025-11-20 â€” Stage 1 Networking & TLS Hardening

## 09:00 Init
- Started implementation phase for Stage 1.
- Goals: add non-blocking receive pipeline in client; gate TLS insecure mode; allow secure cert loading; update call sites/tests.

## 10:00 TLS gating
- Added `TlsMode` enum with env-based resolver (`MDM_INSECURE_TLS`, debug defaults to insecure).
- Server now loads PEM cert/key via `MDM_SERVER_CERT_PATH`/`MDM_SERVER_KEY_PATH` or generates self-signed with warning.
- Client can choose secure vs insecure; secure uses webpki roots, insecure uses custom verifier.
- All call sites/tests updated to pass `TlsMode` (tests use insecure, runtime uses env).

## 10:40 Client receive loop
- Implemented non-blocking drain of reliable/unreliable channels in `MultiplayerClient::process_server_messages` using zero-timeout to avoid frame stalls and surface disconnects.
## 11:30 Tests
- Ran `cargo test -p mdminecraft-net --tests` (pass). Validates updated TLS modes and channel/handshake paths.
## 13:00 Stage 2/3 work
- Mining timing now uses frame `dt`; `handle_block_interaction/handle_mining` take `dt` and `GameWorld` stores `frame_dt`.
- Added cross-chunk skylight stitching (`stitch_light_seams`) with boundary seeding and neighbor-aware propagation; integrated during world init and after block edits.
- Added seam-aware recompute helper and wired into block mining/placement.
- `RegionStore::chunk_exists` now inspects region contents to confirm chunk key.
- Added seam shadow unit test in `lighting.rs`.
## 14:00 Tests (world)
- Ran `cargo test -p mdminecraft-world lighting` (pass). Added block-light seam propagation test.
## 15:00 Tests & docs
- Added integration test `test_input_roundtrip` covering handshake + input + server state across QUIC channels.
- Documented TLS/env behavior and client receive draining: `wrk_docs/2025.11.20 - DOC - TLS and Networking Changes.md`.
- Updated plan to mark block-edit lighting optimization partially addressed.
## 16:00 Integration test & retests
- Fixed unreliable/reliable channel selection in roundtrip test; added short keepalive delay.
- Tests: `cargo test -p mdminecraft-net --tests` (pass), `cargo test -p mdminecraft-world lighting` (pass).
## 16:30 Particle budget HUD
- Added particle budget display (budget vs active) in HUD; wired GameWorld to populate counts.
- Retested world lighting suite (pass).
## 17:00 Tests & additions
- Added helper/test for mining progress FPS-independence (unit test in `src/game.rs`).
- Added regression test for `RegionStore::chunk_exists` ensuring false for missing chunk in existing region.
- Added HUD particle budget display wired to particle emitter counts.
- Test runs:
  - `cargo test -p mdminecraft-net --tests`
  - `cargo test -p mdminecraft-world lighting`
  - `cargo test -p mdminecraft --bin mdminecraft`
## 17:20 Docs
- Updated README running section with TLS/env guidance for secure vs dev-insecure modes and server cert paths.
## 17:40 Warning cleanup
- Removed unused `mut` in lighting neighbour calc. Lighting tests rerun (pass). Remaining warnings limited to test files (intentional for now).
## 18:00 Plan status
- Marked Stage 1-3 as DONE, Stage 4/5/6 partly done in plan doc; remaining TODOs: CI wiring, property tests for lighting border cases, billboard flag, release prep/troubleshooting notes.
## 18:30 CI wiring
- CI workflow now runs targeted regressions: net input roundtrip, lighting seam test, and binary smoke (`cargo test -p mdminecraft --bin mdminecraft --quiet`).
## 18:45 Docs
- Added TLS troubleshooting note (`wrk_docs/2025.11.20 - DOC - TLS Troubleshooting.md`).
## 19:00 Property test
- Added lighting seam property test to ensure stitching never increases light across chunk borders. All lighting proptests now pass.
## 19:15 Plan update
- Stage 5 now marked done (tests + CI + property test). Remaining items: billboard flag (Stage 4 optional) and release/changelog (Stage 6).
## 19:40 Optional feature guard
- Gated billboard pipeline behind `ui3d_billboards` feature to avoid accidental prod use while stubbed.
- `cargo check -p mdminecraft-ui3d --no-default-features` passes.
## 20:00 CI docs update
- Added CI note to TLS/networking doc about new targeted regression steps.
## 20:20 Release notes
- Added release summary doc: `wrk_docs/2025.11.20 - DOC - Release Notes.md`.
## 20:40 Final report
- Compiled final implementation report: `wrk_docs/2025.11.20 - CR - Final Implementation Report.md` summarizing all changes, tests, docs, and open items.
## 21:00 Release prep
- Added CHANGELOG.md with post-2025-11-20 hardening entry; prior 0.1.0 noted.
## 21:30 Plan completion
- Marked Stage 4 and Stage 6 as DONE in plan after gating billboards and adding changelog/troubleshooting. All plan items now covered; release tag left to user discretion.
## 21:50 Final wrap
- Plan marked complete; all mandatory stages DONE. Tagging left to user preference.
## 22:00 Bugfix
- Fixed WGSL parse error (`Voxel Shader` chunk uniform fields now use commas). `cargo test -p mdminecraft --bin mdminecraft --quiet` passes.
## 22:10 Bugfix 2
- Removed deprecated `@builtin(point_size)` from particle shader; pipeline now validates. Binary smoke test passes.
## 22:15 Release notes tweak
- Updated release notes to mention particle shader WGSL fix.
