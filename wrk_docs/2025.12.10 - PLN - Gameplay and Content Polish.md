# Implementation Plan: Gameplay & Content Polish
**Date:** 2025-12-10
**Goal:** Address gameplay deficiencies to match "Canonical Minecraft" expectations.

## Phase 1: World Management (Infinite & Persistent)
**Objective:** Make the world infinite, persistent, and unique per run.

### 1.1 Dynamic Chunk Loading
**Target:** `src/game.rs`
**Problem:** World is fixed 5x5 chunk area.
**Plan:**
1.  Implement `ChunkLoader` struct in `src/game.rs` (or `crates/world`).
    *   Track `loaded_chunks: HashMap<ChunkPos, Chunk>`.
    *   Track `render_distance` (e.g., 8 chunks).
    *   On `fixed_update`, calculate chunks needed around player.
    *   Queue generation for new chunks.
    *   Unload (save & drop) chunks outside range.
2.  Integrate `ChunkLoader` into `GameWorld`.

### 1.2 Persistence (Save/Load)
**Target:** `src/game.rs`, `src/menu.rs`
**Problem:** No saving.
**Plan:**
1.  Initialize `RegionStore` in `GameWorld::new` (path: `saves/world_name`).
2.  Modify `ChunkLoader`:
    *   On load: Try `RegionStore::load_chunk` first. If missing, generate.
    *   On unload: Call `RegionStore::save_chunk`.
3.  Add "Save & Quit" button in menu.

### 1.3 Seed Randomization
**Target:** `src/game.rs`
**Problem:** Hardcoded seed.
**Plan:**
1.  Generate random `u64` seed in `main.rs` or `GameWorld::new`.
2.  Pass seed to `TerrainGenerator`.
3.  (Optional) Add Input Field in Main Menu for custom seed.

---

## Phase 2: Gameplay Mechanics (Fluids & Movement)
**Objective:** Enable water physics and standard movement controls.

### 2.1 Fluid Simulation
**Target:** `src/game.rs`, `crates/world/src/fluid.rs`
**Problem:** `FluidSimulator` exists but is unused.
**Plan:**
1.  Add `fluid_sim: FluidSimulator` to `GameWorld`.
2.  In `fixed_update`, call `self.fluid_sim.tick(&mut self.chunks)`.
3.  Ensure `ChunkManager` (renderer) is notified of mesh updates when fluids change blocks (flags `DirtyFlags::MESH`).

### 2.2 Flight Control
**Target:** `src/input.rs`, `src/game.rs`
**Problem:** Flight requires `F4`. Standard is Double-Jump.
**Plan:**
1.  Modify `PlayerPhysics` to track `jump_timer` (time since last jump press).
2.  In `apply_physics_movement`:
    *   Detect "Jump Pressed" event.
    *   If `jump_pressed` and `jump_timer < 0.3s`, toggle flight mode.
    *   Reset `jump_timer` on jump.

---

## Phase 3: Entities (Mobs & Rendering)
**Objective:** Make mobs visible and functional.

### 3.1 Mob Rendering
**Target:** `crates/render/src/lib.rs` (and new `mob.rs`), `src/game.rs`
**Problem:** Mobs update but don't render.
**Plan:**
1.  Create `MobPipeline` (or generic `EntityPipeline`) in `mdminecraft-render`.
    *   Simple blocky mesh (e.g., 1x2x1 box for zombies/players, 1x1x1 for pigs).
    *   Instance buffer: `position`, `color`, `scale`, `rotation`.
2.  In `GameWorld::render`:
    *   Collect active mobs.
    *   Submit instances to `MobPipeline`.

---

## Phase 4: UI/UX (HUD & Crafting)
**Objective:** Improve visual feedback.

### 4.1 Enhanced HUD
**Target:** `src/game.rs` (egui calls)
**Problem:** Basic text/shapes.
**Plan:**
1.  Refine `egui` drawing.
    *   Use `egui::ProgressBar` with custom styling for health/hunger.
    *   Add "Crosshair" in center.
    *   Improve Hotbar visual (selection highlight).

### 4.2 Crafting UX
**Target:** `src/game.rs`
**Problem:** User doesn't know how to craft.
**Plan:**
1.  Add on-screen hint "Press E for Inventory/Crafting" when starting.
2.  Add a "Recipe Book" or list of available recipes in the Crafting UI.

---

## Execution Order
1.  **Phase 2 (Mechanics)** - High value, easier to implement (Fluids + Flight).
2.  **Phase 1 (World)** - Core architecture change (Infinite World + Save).
3.  **Phase 3 (Mobs)** - Visual payoff.
4.  **Phase 4 (UI)** - Polish.
