# TLS Troubleshooting (mdminecraft)

## Common scenarios
- **Handshake fails with self-signed cert**: set `MDM_INSECURE_TLS=1` on the client (dev only), or point to a trusted cert via system store.
- **Cert mismatch when using real certs**: ensure server is started with `MDM_SERVER_CERT_PATH` and `MDM_SERVER_KEY_PATH` pointing to matching PEM/PKCS8 files.
- **No native roots on CI/minimal images**: provide certs explicitly or enable `MDM_INSECURE_TLS=1` for test-only runs.
- **ALPN mismatch**: client and server use `mdminecraft`; avoid changing unless both ends are updated.

## Quick checks
- Verify env vars: `echo $MDM_INSECURE_TLS`, `echo $MDM_SERVER_CERT_PATH`, `echo $MDM_SERVER_KEY_PATH`.
- On client, run with `RUST_LOG=info` to see TLS mode and warnings.
- On server, failures to load certs fall back to self-signed with a warning; confirm logs.

## Production guidance
- Do **not** set `MDM_INSECURE_TLS`.
- Use certs signed by a trusted CA or distribute an internal CA bundle via system store.
- Rotate keys regularly; restart server after updates.
