# 2025.12.25 - Exploratory Test Plan - Core Engine QA

## Goal

Find and fix as many **core engine** issues as possible by systematically exploring a deterministic world and capturing evidence (screenshots + logs).

Primary focus areas:
- Rendering correctness (visual artifacts, lighting, transparency, sky/weather, chunk seam issues).
- Simulation correctness (day/night cycle, weather transitions, fluids, entity spawning, basic interactions).
- Stability (no panics, no GPU validation errors).

This plan is designed to be **repeatable** and **automatable** via the headless automation harness.

## Scope / Constraints

- Deterministic runs: fixed `--world-seed`, fixed tick stepping (`--automation-step`).
- Visual validation is performed via screenshots captured from headless/offscreen rendering.
- Timebox: run the full scenario suite once, then iterate on discovered issues (fix → rerun relevant scenarios).

## Tooling

- Headless harness (this repo):
  - `--headless`, `--automation-step`, `--automation-listen/--automation-uds`
  - `--screenshot-dir`, `--resolution`
- Reference client:
  - `tools/harness_client/mdm_harness_client.py`
- Evidence:
  - Screenshots: `target/exploratory/run1/*.png`
  - Optional automation JSONL log: `target/exploratory/run1/automation.jsonl`

## Run Configuration (baseline)

Use a fixed seed and a consistent resolution.

- Seed: `123`
- Resolution: `1280x720`
- Screenshot dir: `target/exploratory/run1`
- Transport: TCP on `127.0.0.1:4242` (use UDS if preferred)

Start the game:

```bash
cargo run -- --headless --no-audio --no-save --world-seed 123 \
  --automation-listen 127.0.0.1:4242 --automation-step \
  --resolution 1280x720 \
  --screenshot-dir target/exploratory/run1
```

Then drive it with the reference client:

```bash
python3 tools/harness_client/mdm_harness_client.py --tcp 127.0.0.1:4242 --auto-id --script <SCRIPT.ndjson>
```

## Scenario Suite (what to test)

Each scenario should end with one or more screenshots. The screenshot tags become the primary evidence.

### S0 — Boot / Baseline Stability

Checks:
- No panic on startup.
- `hello` + `get_state` works.
- `screenshot` works (GPU path).

Evidence:
- `spawn_day` screenshot.

### S1 — Day/Night Cycle + Skybox

Checks:
- `/time set day|noon|night|midnight` visibly changes sky/lighting.
- Skybox has no obvious seams/banding.
- At night: darkening is reasonable; emissive/light sources still visible.

Evidence:
- `sky_day`, `sky_noon`, `sky_night`, `sky_midnight`.

### S2 — Weather States

Checks:
- `/weather clear|rain|thunder` transitions.
- Rain/thunder visuals don’t break lighting or alpha blending.
- No extreme flicker or temporal artifacts frame-to-frame for fixed camera.

Evidence:
- `weather_clear`, `weather_rain`, `weather_thunder`.

### S3 — Block Palette (materials + transparency)

Build a small “palette wall” near the player with representative blocks:
- Opaque: `stone`, `dirt`, `grass`, `sand`, `gravel`, `oak_planks`, `cobblestone`, `bricks`
- Transparent/translucent: `glass`, `ice`, `water`
- Emissive: `torch`, `glowstone` (if present)
- Special: `leaves`, `log`, `stairs`/`slabs` (if present)

Checks:
- Textures mapped correctly per face (e.g., grass top/side).
- No Z-fighting at edges; no missing faces.
- Translucent ordering looks sane (especially water+glass).

Evidence:
- `palette_day`, `palette_night`.

### S4 — Chunk Boundary / Lighting Seams

Move to a chunk boundary (x/z multiple of 16), create a structure spanning chunks, and capture.

Checks:
- No mesh cracks at chunk seams.
- Lighting is continuous across boundaries.

Evidence:
- `seam_structure`, `seam_lighting`.

### S5 — Fluids (static + flowing)

Create:
- A shallow water pool (static surface).
- A water source above a ledge (flow).

Checks:
- Flow simulation is stable/deterministic.
- Rendering has correct surface appearance (no “missing quads”).

Evidence:
- `water_static`, `water_flow`.

### S6 — Mobs / Animals (spawn + rendering)

Spawn a small set of entities near the player:
- Passive: `pig`, `cow`, `sheep`, `chicken`, `villager`
- Hostile: `zombie`, `skeleton`, `spider`, `creeper`

Checks:
- Models render correctly (no missing textures/limbs).
- Shadows/lighting behave reasonably.
- No immediate crashes from AI or animation.

Evidence:
- `mobs_passive`, `mobs_hostile`.

### S7 — Basic Interaction Smoke (optional if time permits)

Using automation actions:
- Walk forward, jump, crouch, sprint.
- Attempt attack/use on blocks/entities.

Checks:
- Input mapping works (esp. headless automation).
- No extreme camera jitter or physics explosions.

Evidence:
- `move_smoke_1`, `move_smoke_2` (or short periodic screenshots during a step).

## Reporting / Fix Loop

For each issue found:
1. Record it with evidence (screenshot filename + description).
2. Create a minimal reproduction (commands + seed + tick).
3. Fix with the smallest, most deterministic change possible.
4. Re-run only the relevant scenario(s) to confirm.

If a fix changes visuals, capture “before/after” screenshots in separate run dirs (`run2`, `run3`, …).

