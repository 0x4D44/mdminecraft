# Vanilla Parity Implementation Journal

**Date:** 2025-12-19  
**Repo:** `/home/md/language/mdminecraft`  
**Plan:** `wrk_docs/2025.12.19 - PLN - Feature Gap Closure Plan toward Vanilla Minecraft.md`  

---

## 2025-12-19

### Stage 3 — Farming expansion: carrots + potatoes (+ baked potato)

- Added dropped-item support for **carrot**, **potato**, and **baked potato** (stable IDs appended), plus dropped↔core conversion mappings so pickup/drop works end-to-end.
- Extended core food types to include **Carrot**, **Potato**, and **BakedPotato**, and tuned hunger restore values.
- Expanded right-click farmland interactions:
  - wheat seeds → wheat (`wheat_0`)
  - carrot → carrots (`carrots_0`)
  - potato → potatoes (`potatoes_0`)
  - clicks on farmland now “belong” to planting attempts (so they don’t accidentally eat the held food when the spot is blocked).
- Added vanilla-ish deterministic drops:
  - mature carrots/potatoes drop extra produce in addition to the base drop.
- Added a vanilla-ish deterministic acquisition path:
  - zombies can drop carrots/potatoes (small deterministic chance) to bootstrap farming.
- Added furnace parity:
  - potato → baked potato smelting recipe in the world furnace.

### Verification (post-change 77)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing: gunpowder → splash potions

- Added `bottle_is_splash` to `BrewingStandState` (serde-defaulted for backwards-compatible deserialization) and implemented the gunpowder brewing step to convert drinkable potions into splash variants.
- Wired client↔world mappings so gunpowder is accepted as a brewing ingredient and bottles preserve splash state through the UI/hotbar.
- Added dropped-item support for splash potions so dropping/spilling/brewing-stand-break drops are safe.
- Added a micro snapshot for the gunpowder→splash conversion step.

### Verification (post-change 78)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing expansion: spider eyes → poison

- Added dropped-item support for **spider eyes** (stable IDs appended) and wired dropped↔core conversion so pickup/drop works end-to-end.
- Added a client-side core item ID for spider eyes and mapped it into the brewing ingredient pipeline (`SPIDER_EYE`), enabling brewing stand UI placement and shift-move.
- Added vanilla-ish deterministic spider-eye drops to spiders (0–1 per kill) to support acquiring the ingredient in survival.
- Added a micro snapshot covering **Awkward + Spider Eye → Poison**.

### Verification (post-change 79)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing expansion: golden carrots → night vision

- Added `FoodType::GoldenCarrot` (edible) and dropped-item support so pickup/drop works end-to-end.
- Added a vanilla-ish crafting recipe: **carrot + gold ingot → golden carrot**.
- Wired brewing ingredient mapping so golden carrots are accepted by the brewing stand (enables **Awkward + Golden Carrot → Night Vision**).
- Added unit coverage for crafting + brewing-slot shift-move behavior and conversion mappings.

### Verification (post-change 80)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Sugar cane + paper/books chain (+ brewing sugar → swiftness)

- Added **sugar cane** as a real block (appended to `config/blocks.json` and block ID constants) with:
  - vanilla-ish placement rules (must be on dirt/grass/sand adjacent to water, or stacked on sugar cane)
  - support removal behavior (column breaks when support is removed)
  - deterministic worldgen near water + deterministic growth system
- Added dropped-item support (stable IDs appended) for:
  - **SugarCane** (placeable block item)
  - **Sugar**, **Paper**, **Book** (generic items)
  - plus dropped↔core conversion mappings so pickup/drop/spill works end-to-end.
- Added vanilla-ish crafting chain:
  - sugar cane → sugar
  - 3 sugar cane → 3 paper
  - 3 paper + leather → book
  - updated bookshelf recipe to **6 planks + 3 books → bookshelf** (removes the old wheat placeholder).
- Wired sugar into brewing ingredient mapping so **Awkward + Sugar → Swiftness** is playable via the brewing stand UI.
- Added a micro snapshot covering **Awkward + Sugar → Swiftness**, plus unit coverage for crafting/conversions/support removal.

### Verification (post-change 81)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing expansion: brown mushrooms + fermented spider eye

- Added **brown mushrooms** as a real block (appended to `config/blocks.json` as ID 105) with:
  - vanilla-ish placement rules (top-face only; requires a solid support block)
  - support removal behavior (pops if the supporting block is removed)
  - deterministic worldgen (cave-ish placements; constrained to avoid altering surface-scanning worldtests)
- Added dropped-item support (stable IDs appended) for:
  - **BrownMushroom** (placeable block item)
  - **FermentedSpiderEye** (brewing ingredient item)
  - plus dropped↔core conversion mappings so pickup/drop/spill works end-to-end.
- Added a vanilla-ish crafting recipe:
  - **brown mushroom + sugar + spider eye → fermented spider eye** (shapeless; works in 2×2).
- Wired fermented spider eyes into the brewing ingredient pipeline (`FERMENTED_SPIDER_EYE`), enabling brewing stand UI placement + shift-move.
- Added a micro snapshot covering **Swiftness + Fermented Spider Eye → Slowness**, plus unit coverage for crafting, shift-move, and conversion mappings.

### Verification (post-change 82)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing expansion: magma cream + fire resistance

- Added a deterministic Overworld proxy block **magma_cream_ore** (appended to `config/blocks.json` as ID 106) and integrated it into ore generation at low Y so magma cream is obtainable before Nether content exists.
- Added dropped-item + core-item wiring for **Magma Cream**, including brewing stand UI acceptance + shift-move behavior.
- Added a micro snapshot covering **Awkward + Magma Cream → Fire Resistance**.

### Verification (post-change 83)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing expansion: ghast tears + regeneration

- Added a deterministic Overworld proxy block **ghast_tear_ore** (appended to `config/blocks.json` as ID 107) and integrated it into low-Y ore generation to provide an early access path to ghast tears before Nether content exists.
- Added dropped-item + core-item wiring for **Ghast Tear**, including brewing stand UI acceptance + shift-move behavior.
- Added a micro snapshot covering **Awkward + Ghast Tear → Regeneration**.

### Verification (post-change 84)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing expansion: glistering melons + rabbit feet (healing + leaping)

- Added deterministic Overworld proxy ore blocks:
  - **glistering_melon_ore** (appended to `config/blocks.json` as ID 108)
  - **rabbit_foot_ore** (appended to `config/blocks.json` as ID 109)
  - integrated into low-Y ore generation so the ingredients are obtainable without Nether/mob additions.
- Added dropped-item + core-item wiring for **Glistering Melon** and **Rabbit Foot**, including brewing stand UI acceptance + shift-move behavior.
- Added micro snapshots covering:
  - **Awkward + Glistering Melon → Healing**
  - **Awkward + Rabbit Foot → Leaping**

### Verification (post-change 85)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing expansion: phantom membranes + slow falling

- Added a deterministic Overworld proxy ore block **phantom_membrane_ore** (appended to `config/blocks.json` as ID 110) and integrated it into low-Y ore generation so phantom membranes are obtainable without Nether/mob additions.
- Added dropped-item + core-item wiring for **Phantom Membrane**, including brewing stand UI acceptance + shift-move behavior.
- Completed client-side potion plumbing for **Slow Falling** (drink + splash), including dropped↔core conversions for both bottle types.
- Added a micro snapshot covering **Awkward + Phantom Membrane → Slow Falling**.

### Verification (post-change 86)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Potions: gameplay effects + glass bottle return

- Implemented core potion gameplay effects so brewed potions are no longer “cosmetic-only”:
  - **Swiftness/Slowness** now modify player movement speed.
  - **Leaping** now boosts jump velocity.
  - **Strength/Weakness** now modify melee damage.
  - **Slow Falling** now reduces falling gravity/terminal velocity and prevents fall damage while active.
  - **Regeneration/Poison** now tick health over time (vanilla-ish intervals; poison won’t kill).
  - **Healing/Harming** now apply instantly when drunk.
- Drinking a potion now returns an **empty glass bottle** to storage (or spills if full).
- Added focused unit coverage for instant + over-time potion health effects.

### Verification (post-change 87)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`

### Stage 3 — Brewing modifiers: redstone/glowstone (Long/Strong variants)

- Added deterministic Overworld proxy ore blocks:
  - `redstone_dust_ore` (ID 111) → drops **Redstone Dust**
  - `glowstone_dust_ore` (ID 112) → drops **Glowstone Dust**
- Implemented per-bottle modifier state in `BrewingStandState`:
  - `bottle_is_extended` (redstone “long” duration)
  - `bottle_amplifier` (glowstone “strong” level; currently 0–1)
  - both are `serde(default)` for backwards-compatible save loads.
- Implemented redstone/glowstone brewing behavior (vanilla-ish constraints):
  - **Redstone Dust** extends duration for duration potions (no effect on instant potions).
  - **Glowstone Dust** strengthens supported potions (Swiftness/Leaping/Healing/Harming/Poison/Regeneration/Strength).
  - Modifiers are preserved across normal recipe transformations when meaningful, otherwise clamped/cleared.
- Appended stable core potion IDs for long/strong variants and wired UI naming + bottle↔core conversions so inventories represent variants correctly.
- Updated potion gameplay application (drink + splash) to honor **extended duration** and **amplifier** (including strong Healing/Harming).
- Added dropped-item variants for long/strong potions (drinkable + splash) plus dropped↔core conversion mappings so pickup/drop works end-to-end.
- Added parity micro snapshots covering:
  - Swiftness + Redstone Dust → **Long Swiftness**
  - Healing + Glowstone Dust → **Strong Healing**

### Verification (post-change 88)

- `cargo fmt --all`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo test --workspace`
- `MDM_UPDATE_SNAPSHOTS=1 cargo test -p mdminecraft-world --test parity_micro_snapshots`
